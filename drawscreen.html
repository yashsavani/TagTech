<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
</head>
<body>
<div id="container"></div>

<script src="js/imagesource.js"></script>

<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.css" />
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>

<script>
    $(document).bind( "mobileinit", function(){
        //alert("mobileinit fired");  
        $.support.cors = true;
        $.mobile.allowCrossDomainPages = true;       
    });        
</script>   

<script src="http://code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.js"></script>

<script type="text/javascript" src="http://jindo.dev.naver.com/collie/deploy/collie.min.js"></script>
<script type="text/javascript">

collie.util.addEventListener(window, "load", function () {
	var windowWidth = 800;
	var windowHeight = 450;

    var layer = new collie.Layer({
        width: windowWidth,
        height: windowHeight
    });

	var handLayer = new collie.Layer({
        width: windowWidth,
        height: windowHeight
    });

	/*var frameLayer = new collie.Layer({
        width: windowWidth,
        height: windowHeight
    });*/

    var oSelectedDisplayObject = null;
    var htStartPosition = {};
    var htSelectedDisplayObjectPosition = {};
    var objectCount = 0;
    var selectedObjects = new Array();

    handLayer.attach({
        mousedown : function (oEvent) {
            if (oEvent.displayObject) {
            	if(oEvent.displayObject.get("scale") != cardScale) {
            		oEvent.displayObject.set({
            			scaleX : cardScale,
            			scaleY : cardScale,
            			scale : cardScale
            		});
            		objectCount--;
            	}else {
            		oEvent.displayObject.set({
                    	scaleX : oEvent.displayObject.get("scale") * 1.2,
                    	scaleY : oEvent.displayObject.get("scale") * 1.2,
                    	scale : oEvent.displayObject.get("scale") * 1.2
                	});
                	objectCount++;
                	console.log(objectCount);
                	if(objectCount == 4) {
                		$.mobile.changePage("ActionBarTest.html");
                	}
            	}
                oSelectedDisplayObject = oEvent.displayObject;
                htStartPosition = {
                    x : oEvent.x,
                    y : oEvent.y 
                };
                htSelectedDisplayObjectPosition = {
                    x : oSelectedDisplayObject.get("x"),
                    y : oSelectedDisplayObject.get("y")
                };
            }
        },
        mouseup : function (oEvent) {
            if (oSelectedDisplayObject !== null) {
                oSelectedDisplayObject = null;
                htSelectedDisplayObjectPosition = htStartPosition = {};
                
                handLayer.removeChild(oEvent.displayObject);
                handLayer.addChild(oEvent.displayObject);
            }
        },
        /*mousemove : function (oEvent) {
            if (oSelectedDisplayObject !== null) {
                var x = htStartPosition.x - oEvent.x;
                var y = htStartPosition.y - oEvent.y;
                oSelectedDisplayObject.set({
                    x : htSelectedDisplayObjectPosition.x - x,
                    y : htSelectedDisplayObjectPosition.y - y
                });
            }
        }*/
    });
	
	// collie.ImageManager.add({
	// 	handLayerbackground: testArray["handLayerbackground"],
	// 	mage: testArray["mage"],
	// 	warrior: testArray["warrior"],
	// 	warriorAttack: testArray["warriorAttack"],
	// 	swordCard: testArray["swordCard"],
	// 	cardGlow: testArray["cardGlow"],
	// 	cardBack: testArray["cardBack"],
	// 	frame: testArray["frame"]
	// });

	collie.ImageManager.add({
		handLayerbackground: "img/handbackground.png",
		mage: "img/mage.png",
		warrior: "img/warrior.png",
		swordCard: "img/MedSwordCard.png",
		cardBack: "img/cardBack.png",
	});

	wScale = windowWidth / 800;
	hScale = windowHeight / 450;
	
	var handLayerbackground = new collie.DisplayObject({
		x: "center",
		y: "center",
		width: 1920,
		height: 1080,
		backgroundImage: "handLayerbackground",
		scaleX:  80/192,
		scaleY:  45/108
		//scale: 0.416 * wScale
	}).addTo(layer);
	
	var cardWidth = 150;
	var cardHeight = 200;
	var cardScale = 0.8 * wScale;
	var numCards = 8;
	
	var testArray = new Array();
	
	for(var i=0; i < 7; i++) {
		testArray[i] = "swordCard";
	}
	
	
	var hand = new Array();
	var numHighlight = 4;
	var currentHighlight = 0;
	
	for(var i=0; i < numCards; i++) {
		var xPos, yPos;
		if(i < 4) {
			xPos = (windowWidth/5)*(i+1) - cardWidth/2;
			yPos = (windowHeight)/2.2 - (cardWidth)/4 - cardWidth;
		} else {
			xPos = (windowWidth/5)*(i-3) - cardWidth/2;
			yPos = (windowHeight)/2.2 + (cardWidth)/8;
		}
		hand[i] = new collie.DisplayObject({
			x: xPos,
			y: yPos,
			width: cardWidth,
			height: cardHeight,
			useEvent : true,
			backgroundImage: testArray[i], 
			scaleX : cardScale,
			scaleY : cardScale, 
			scale: cardScale
		}).addTo(handLayer);
	
    var deck = new collie.DisplayObject({
			x: (windowWidth/5) * 4 -cardWidth/2,
			y: (windowHeight)/2.2 + (cardWidth)/8,
			width: cardWidth,
			height: cardHeight,
			backgroundImage: "cardBack", 
			scaleX : cardScale,
			scaleY : cardScale, 
			scale: cardScale
		}).addTo(handLayer);
	}

	collie.Renderer.addLayer(layer);
	collie.Renderer.addLayer(handLayer);
	//collie.Renderer.addLayer(frameLayer);
	collie.Renderer.load(document.getElementById("container"));
	collie.Renderer.start("30fps");
});

</script>
</body>
</html>