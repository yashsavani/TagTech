<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
</head>
<body>
<div id="container"></div>

<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.css" />
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.js"></script>

<script type="text/javascript" src="http://jindo.dev.naver.com/collie/deploy/collie.min.js"></script>
<script type="text/javascript">

collie.util.addEventListener(window, "load", function () {
	var windowWidth, windowHeight;
	if($(window).height() < $(window).width() * 45/80) {
		windowWidth = $(window).width();
		windowHeight = windowWidth * 45/80;
	} else {
		windowHeight = $(window).height();
		windowWidth = windowHeight * 80/45;
	}

    var layer = new collie.Layer({
        width: windowWidth,
        height: windowHeight
    });
	var handLayer = new collie.Layer({
        width: windowWidth,
        height: windowHeight
    });
	var character = new collie.Layer({
		width: windowWidth,
		height: windowHeight
	});
	var frameLayer = new collie.Layer({
        width: windowWidth,
        height: windowHeight
    });

    var oSelectedDisplayObject = null;
    var htStartPosition = {};
    var htSelectedDisplayObjectPosition = {};
    
    handLayer.attach({
        mousedown : function (oEvent) {
            if (oEvent.displayObject) {
                oEvent.displayObject.set({
                    scaleX : oEvent.displayObject.get("scale") * 1.2,
                    scaleY : oEvent.displayObject.get("scale") * 1.2
                });
                oSelectedDisplayObject = oEvent.displayObject;
                htStartPosition = {
                    x : oEvent.x,
                    y : oEvent.y 
                };
                htSelectedDisplayObjectPosition = {
                    x : oSelectedDisplayObject.get("x"),
                    y : oSelectedDisplayObject.get("y")
                };
            }
        },
        mouseup : function (oEvent) {
            if (oSelectedDisplayObject !== null) {
                oSelectedDisplayObject.set({
                    scaleX : oSelectedDisplayObject.get("scale"),
                    scaleY : oSelectedDisplayObject.get("scale")
                });
                oSelectedDisplayObject = null;
                htSelectedDisplayObjectPosition = htStartPosition = {};
                
                handLayer.removeChild(oEvent.displayObject);
                handLayer.addChild(oEvent.displayObject);
            }
			if (!oTimerSelect.isPlaying()) {
                oTimer.stop();
                oTimerSelect.start();
            }
        },
        /*mousemove : function (oEvent) {
            if (oSelectedDisplayObject !== null) {
                var x = htStartPosition.x - oEvent.x;
                var y = htStartPosition.y - oEvent.y;
                oSelectedDisplayObject.set({
                    x : htSelectedDisplayObjectPosition.x - x,
                    y : htSelectedDisplayObjectPosition.y - y
                });
            }
        }*/
    });

	//hardcoded map of cards to locations:
	var testArray = new Array();
	testArray["mage"] = "img/mage.png";
	testArray["warrior"] = "img/warrior.png";
	testArray["swordCard"] = "img/MedSwordCard.png";
	testArray["handLayerbackground"] = "img/handbackground.png";
	testArray["warriorAttack"] = "img/warrior.png";
	testArray["cardGlow"] = "img/cardglow.png";
	testArray["frame"] = "img/backgroundframe.png";
	testArray["cardBack"] = "img/cardback.png";
	
	collie.ImageManager.add({
		handLayerbackground: testArray["handLayerbackground"],
		mage: testArray["mage"],
		warrior: testArray["warrior"],
		warriorAttack: testArray["warriorAttack"],
		swordCard: testArray["swordCard"],
		cardGlow: testArray["cardGlow"],
		cardBack: testArray["cardBack"],
		frame: testArray["frame"]
	});

	wScale = windowWidth / 800;
	hScale = windowHeight / 450;
	
	var handLayerbackground = new collie.DisplayObject({
		x: 0,
		y: 0,
		width: windowWidth,
		height: windowHeight,
		backgroundImage: "handLayerbackground",
		scaleX:  wScale,
		scaleY:  hScale,
		scale: wScale
	}).addTo(layer);
	
	var cardWidth = 150;
	var cardHeight = 200;
	var cardScale = 0.8 * wScale;
	var numCards = 8;
	
	var testArray = new Array();
	
	for(var i=0; i < 7; i++) {
		testArray[i] = "swordCard";
	}
	
	
	var hand = new Array();
	var numHighlight = 4;
	var currentHighlight = 0;
	
	for(var i=0; i < numCards; i++) {
		var xPos, yPos;
		if(i < 4) {
			xPos = (windowWidth/5)*(i+1) - cardWidth/2;
			yPos = (windowHeight)/2 - (cardWidth)/6 - cardWidth;
		} else {
			xPos = (windowWidth/5)*(i-3) - cardWidth/2;
			yPos = (windowHeight)/2 + (cardWidth)/6;
		}
		hand[i] = new collie.DisplayObject({
			x: xPos,
			y: yPos,
			width: cardWidth,
			height: cardHeight,
			useEvent : true,
			backgroundImage: testArray[i], 
			scaleX : cardScale,
			scaleY : cardScale, 
			scale: cardScale
		}).addTo(handLayer);
		/*var oAvatarWalk = new collie.DisplayObject({
        x : 0,
        y : 0,
        width : 70,
        height : 150,
        backgroundImage : "bird_walk"
    }).addTo(oAvatar);*/
     
    var highlight = new collie.DisplayObject({
        width : -10,
        height : -10,
        spriteLength : 0,
        backgroundImage : "cardGlow",
        visible : false
    }).addTo(hand[i]);
     
    var oTimer = collie.Timer.cycle(highlight, "1fps", {
        to : 0,
        loop : 0,
        onStart : function () {
            highlight.set("visible", false);
        }
    });
     
    var oTimerSelect = collie.Timer.cycle(highlight, "1fps", {
        from : 0,
        to : 0,
        loop : 0,
        useAutoStart : false,
        onStart : function () {
			//alert('visible: %d', highlight.get('visible'));
            highlight.set("visible", true);
        },
        onComplete : function () {
            oTimer.start();
        }
    });
	}
	
    var deck = new collie.DisplayObject({
			x: (windowWidth/5) * 4 -cardWidth/2,
			y: (windowHeight)/2 + (cardWidth)/6,
			width: cardWidth,
			height: cardHeight,
			backgroundImage: "cardBack", 
			scaleX : cardScale,
			scaleY : cardScale, 
			scale: cardScale
		}).addTo(handLayer);
		
	var frame = new collie.DisplayObject({
		x: 0,
		y: 0,
		width: windowWidth,
		height: windowHeight,
		backgroundImage: "frame",
		scaleX: wScale,
		scaleY: hScale,
		scale: wScale
	}).addTo(frameLayer);
	
	/*var currentY = swordCard.get("y");
	swordCard.attach({
		click: function (e) {
			collie.Timer.queue().
				transition(swordCard, 400, {
					to: currentY - 100,
					effect: collie.Effect.easeOut,
					set: "y"
				}).
				transition(swordCard, 400, {
					to: currentY,
					effect: collie.Effect.easeIn,
					set: "y"
				});
			
		}
	});*/

	collie.Renderer.addLayer(layer);
	collie.Renderer.addLayer(handLayer);
	collie.Renderer.addLayer(character);
	collie.Renderer.addLayer(frameLayer);
	collie.Renderer.load(document.getElementById("container"));
	collie.Renderer.start("30fps");
});
</script>
</body>
</html>