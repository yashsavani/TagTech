<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>TagTech</title>
	<!-- <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" /> -->

	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">

	<link rel="stylesheet" type="text/css" href="css/style.css">

</head>
<body>

	<div class="container">
		<div class="surrender"><button id="surrender" class="btn btn-lg btn-primary btn-block">Surrender</button></div>
		<div class="health">
			<div class="opponent progressbar"></div>
			<div class="player progressbar"></div>
		</div>
		<div class="play-area">
			<div class="player_one"></div>
			<div class="player_two"></div>
		</div>
		<div class="card-arena">
		</div>
	</div>
	

	<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js'></script>
	<script src='https://cdn.firebase.com/v0/firebase.js'></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
	<script type='text/javascript' src='https://cdn.firebase.com/js/simple-login/1.2.1/firebase-simple-login.js'></script>
	<script type="text/javascript">
	(function( $ ){
		$(function() {
			$( ".progressbar" ).progressbar({
				value: 100
			});
		});

		$(document).ready(function() {
			var myRootRef = new Firebase('https://tagtech.firebaseio.com/');
			var myUid;

			var auth = new FirebaseSimpleLogin(myRootRef, function(error, user) {
		        if (error) {
		            // an error occurred while attempting login
		            alert(error);
		          } else if (user) {
		          	myUid = user.uid
		            // user authenticated with Firebase
		            myRootRef.child("users").child("searching").once( 'value', function(online_users){
		              var uids = online_users.val()
		              if(uids == null) {
		                myRootRef.child("users").update({"searching" : myUid});
		              } else {
		              	myRootRef.child("users").child("searching").once( 'value', function(searching_user_uid){
		              		setup_game(searching_user_uid.val())
			              	myRootRef.child("users").update({"searching" : null});
			              	$("body").fadeOut(500, redirectPage);
		              	});
		              }
		            });
		          } else {
		            // user is logged out
		            window.location.href = "index.html";
		        }
		    });
			
			var p_deck_pos = 0;
			var o_deck_pos = 0;

			var playerRef = myRootRef.child("tagtech_dynamic").child(myUid)
			playerRef.child("opponent").once('value', function(opponent_uid) {
				var opponentRef = myRootRef.child("tagtech_dynamic").child(opponent_uid.val());

				playerRef.child('deck').once('value', function( cards ) {
					var deck = cards.val();
					var hand = new Array;
					for(var i = p_deck_pos; i < p_deck_pos+5; ++i) {
						hand.push(deck[i])
					}
					playerRef.child('hand').set(hand);
				});

			});

		}));
	})(jQuery);
	</script>
</body>
</html>